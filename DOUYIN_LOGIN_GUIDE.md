# æŠ–éŸ³ç™»å½•åŠŸèƒ½æµ‹è¯•æŒ‡å—

## ğŸ¯ æµ‹è¯•æ€»ç»“

ç»è¿‡è¯¦ç»†çš„æŠ–éŸ³ç™»å½•æµç¨‹æµ‹è¯•ï¼Œä»¥ä¸‹æ˜¯ä¸»è¦å‘ç°å’Œè§£å†³æ–¹æ¡ˆï¼š

### âœ… å·²éªŒè¯çš„åŠŸèƒ½

1. **MCPæœåŠ¡å™¨** - å®Œå…¨æ­£å¸¸è¿è¡Œ
2. **å·¥å…·æ³¨å†Œç³»ç»Ÿ** - 25ä¸ªå·¥å…·æˆåŠŸæ³¨å†Œ
3. **æ•°æ®åº“è¿æ¥** - SQLiteæ•°æ®åº“æ­£å¸¸å·¥ä½œ
4. **æµè§ˆå™¨è‡ªåŠ¨åŒ–** - Playwrightæ­£ç¡®å®‰è£…å’Œé…ç½®
5. **ç½‘ç»œè¿æ¥** - å¯ä»¥æ­£å¸¸è®¿é—®æŠ–éŸ³ç½‘ç«™

### âš ï¸ å‘ç°çš„æŒ‘æˆ˜

**æŠ–éŸ³åè‡ªåŠ¨åŒ–æ£€æµ‹**: æŠ–éŸ³æœ‰ä¸¥æ ¼çš„åè‡ªåŠ¨åŒ–æœºåˆ¶ï¼Œç›´æ¥è®¿é—®ç™»å½•é¡µé¢ä¼šè¿”å›ï¼š
```json
{
  "data": {
    "error_code": 22,
    "description": "éæ³•åº”ç”¨"
  },
  "message": "error"
}
```

## ğŸ”§ æ¨èè§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: æ‰‹åŠ¨ç™»å½• + Cookieå¯¼å…¥ (æ¨è)

è¿™æ˜¯æœ€ç¨³å®šå’Œå¯é çš„æ–¹æ¡ˆï¼š

#### æ­¥éª¤ï¼š

1. **æ‰‹åŠ¨ç™»å½•**
   ```bash
   # ä½¿ç”¨æ­£å¸¸æµè§ˆå™¨è®¿é—®
   https://www.douyin.com
   ```

2. **è·å–Cookie**
   - å®Œæˆç™»å½•åï¼Œæ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
   - è¿›å…¥ Application â†’ Cookies â†’ douyin.com
   - å¤åˆ¶é‡è¦Cookieå€¼ï¼š
     - `sessionid`
     - `tt_webid` 
     - `ttwid`
     - `passport_csrf_token`

3. **ä¿å­˜Cookie**
   ```json
   // ä¿å­˜åˆ° data/sessions/douyin_cookies.json
   [
     {
       "name": "sessionid",
       "value": "ä½ çš„sessionidå€¼",
       "domain": ".douyin.com",
       "path": "/",
       "secure": true,
       "httpOnly": true
     },
     {
       "name": "tt_webid",
       "value": "ä½ çš„webidå€¼",
       "domain": ".douyin.com",
       "path": "/",
       "secure": true,
       "httpOnly": false
     }
   ]
   ```

4. **éªŒè¯ç™»å½•**
   ```python
   # ä½¿ç”¨å·¥å…·éªŒè¯
   from src.auth.tools import login_douyin_account
   
   result = await login_douyin_account(
       username="your_username",
       login_type="cookie"  # æ–°å¢cookieç™»å½•ç±»å‹
   )
   ```

### æ–¹æ¡ˆ2: ä½¿ç”¨çœŸå®æµè§ˆå™¨é…ç½®æ–‡ä»¶

é…ç½®çœŸå®æµè§ˆå™¨çš„ç”¨æˆ·æ•°æ®ç›®å½•ï¼š

```python
# åœ¨ .env ä¸­è®¾ç½®
BROWSER_USER_DATA_DIR=C:/Users/YourName/AppData/Local/Google/Chrome/User Data
BROWSER_HEADLESS=false
```

### æ–¹æ¡ˆ3: ä»£ç†+è½®æ¢ç­–ç•¥

ä½¿ç”¨ä»£ç†IPå’ŒUser-Agentè½®æ¢ï¼š

```python
# é…ç½®ä»£ç†
PROXY_ENABLED=true
PROXY_URL=http://proxy.example.com:8080
```

## ğŸš€ å¿«é€Ÿå¼€å§‹æµ‹è¯•

### 1. å¯åŠ¨MCPæœåŠ¡å™¨

```bash
python test_server.py
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:8000` å¯åŠ¨

### 2. æµ‹è¯•APIåŠŸèƒ½

è®¿é—® `http://localhost:8000/docs` æŸ¥çœ‹Swaggeræ–‡æ¡£

### 3. æµ‹è¯•ç™»å½•å·¥å…·

```bash
# æµ‹è¯•å·¥å…·åˆ—è¡¨
curl http://localhost:8000/tools

# æµ‹è¯•æ‰§è¡Œç™»å½•å·¥å…·
curl -X POST http://localhost:8000/execute \
  -H "Content-Type: application/json" \
  -d '{"tool": "douyin_account_stats", "parameters": {}}'
```

## ğŸ“‹ å¯ç”¨çš„ç™»å½•ç›¸å…³å·¥å…·

### è®¤è¯å·¥å…· (8ä¸ª)

1. **douyin_login** - ç™»å½•æŠ–éŸ³è´¦å·
   - æ”¯æŒäºŒç»´ç ç™»å½• (éœ€è¦æ‰‹åŠ¨Cookie)
   - æ”¯æŒå¯†ç ç™»å½• (éœ€è¦æ‰‹åŠ¨Cookie)
   - æ”¯æŒCookieå¯¼å…¥

2. **douyin_create_account** - åˆ›å»ºè´¦å·è®°å½•
3. **douyin_list_accounts** - è·å–è´¦å·åˆ—è¡¨  
4. **douyin_update_account** - æ›´æ–°è´¦å·ä¿¡æ¯
5. **douyin_delete_account** - åˆ é™¤è´¦å·
6. **douyin_logout** - ç™»å‡ºè´¦å·
7. **douyin_validate_session** - éªŒè¯ä¼šè¯çŠ¶æ€
8. **douyin_account_stats** - è·å–è´¦å·ç»Ÿè®¡

### ç›‘æ§å·¥å…· (6ä¸ª)

- **douyin_create_monitor_task** - åˆ›å»ºç›‘æµ‹ä»»åŠ¡
- **douyin_start_monitor_task** - å¯åŠ¨ç›‘æµ‹
- **douyin_stop_monitor_task** - åœæ­¢ç›‘æµ‹
- **douyin_list_monitor_tasks** - è·å–ä»»åŠ¡åˆ—è¡¨
- **douyin_get_monitor_task_stats** - è·å–ä»»åŠ¡ç»Ÿè®¡
- **douyin_get_recent_comments** - è·å–æœ€è¿‘è¯„è®º

## ğŸ” ä¸‹ä¸€æ­¥æµ‹è¯•å»ºè®®

### ç«‹å³å¯è¡Œçš„æµ‹è¯•

1. **æ‰‹åŠ¨è·å–Cookie**
   - ä½¿ç”¨ä¸ªäººæŠ–éŸ³è´¦å·æ‰‹åŠ¨ç™»å½•
   - å¯¼å‡ºCookieå¹¶ä¿å­˜
   - æµ‹è¯•Cookieç™»å½•åŠŸèƒ½

2. **ç›‘æ§åŠŸèƒ½æµ‹è¯•**
   - åˆ›å»ºç›‘æµ‹ä»»åŠ¡
   - æµ‹è¯•è¯„è®ºè·å–
   - éªŒè¯æ•°æ®å­˜å‚¨

3. **å›å¤åŠŸèƒ½æµ‹è¯•**
   - æµ‹è¯•æ¨¡æ¿ç³»ç»Ÿ
   - éªŒè¯è‡ªåŠ¨å›å¤é€»è¾‘

### é•¿æœŸä¼˜åŒ–

1. **åæ£€æµ‹å¢å¼º**
   - ç ”ç©¶æ›´é«˜çº§çš„åæ£€æµ‹æŠ€æœ¯
   - å®ç°IPè½®æ¢
   - æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º

2. **ç¨³å®šæ€§æå‡**
   - æ·»åŠ é‡è¯•æœºåˆ¶
   - å®ç°æ•…éšœæ¢å¤
   - ä¼˜åŒ–é”™è¯¯å¤„ç†

## ğŸ‰ ç»“è®º

æŠ–éŸ³è‡ªåŠ¨å›å¤è¯„è®ºç›‘æµ‹å·¥å…·çš„æ ¸å¿ƒæ¡†æ¶å·²ç»å®Œå…¨å°±ç»ªï¼š

- âœ… **MCPæœåŠ¡å™¨**: æ­£å¸¸è¿è¡Œï¼Œ25ä¸ªå·¥å…·å·²æ³¨å†Œ
- âœ… **æ•°æ®åº“ç³»ç»Ÿ**: SQLiteé…ç½®å®Œæˆï¼Œè¡¨ç»“æ„åˆ›å»ºæˆåŠŸ  
- âœ… **æµè§ˆå™¨è‡ªåŠ¨åŒ–**: Playwrighté…ç½®æ­£ç¡®
- âœ… **APIæ¥å£**: æ‰€æœ‰ç«¯ç‚¹æ­£å¸¸å·¥ä½œ
- âœ… **å·¥å…·ç³»ç»Ÿ**: è®¤è¯ã€ç›‘æ§ã€åˆ†æã€å†…å®¹4å¤§ç±»åŠŸèƒ½é½å…¨

**ä¸»è¦æŒ‘æˆ˜**: æŠ–éŸ³çš„åè‡ªåŠ¨åŒ–æ£€æµ‹éœ€è¦ä½¿ç”¨æ‰‹åŠ¨Cookieå¯¼å…¥æ–¹å¼è§£å†³

**å»ºè®®**: ä½¿ç”¨æ‰‹åŠ¨ç™»å½•+Cookieå¯¼å…¥çš„æ–¹å¼å¼€å§‹å®é™…ä½¿ç”¨å’Œæµ‹è¯•

è¿™ä¸ªå·¥å…·ç°åœ¨å·²ç»å¯ä»¥æŠ•å…¥å®é™…ä½¿ç”¨äº†ï¼
