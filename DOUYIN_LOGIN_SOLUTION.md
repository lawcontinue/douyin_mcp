# æŠ–éŸ³ç™»å½•é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜åˆ†æ

ç»è¿‡è¯¦ç»†æµ‹è¯•ï¼Œå‘ç°æŠ–éŸ³æœ‰ä¸¥æ ¼çš„åçˆ¬è™«æ£€æµ‹æœºåˆ¶ï¼š

### æ£€æµ‹åˆ°çš„é”™è¯¯
```json
{
  "data": {
    "captcha": "",
    "desc_url": "",
    "description": "éæ³•åº”ç”¨",
    "error_code": 22
  },
  "message": "error"
}
```

### æµ‹è¯•ç»“æœæ€»ç»“
- âœ… **æµè§ˆå™¨åˆå§‹åŒ–**: æˆåŠŸ
- âœ… **ç½‘ç»œè¿æ¥**: æ­£å¸¸
- âœ… **æŠ–éŸ³ä¸»é¡µè®¿é—®**: æˆåŠŸ
- âŒ **ç™»å½•é¡µé¢è®¿é—®**: è¢«åçˆ¬è™«æ£€æµ‹æ‹¦æˆª
- âŒ **äºŒç»´ç è·å–**: å¤±è´¥ï¼ˆé¡µé¢è¢«æ‹¦æˆªï¼‰

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: æ‰‹åŠ¨Cookieå¯¼å…¥ï¼ˆæ¨èï¼‰

è¿™æ˜¯æœ€ç¨³å®šå’Œå¯é çš„æ–¹æ¡ˆï¼š

#### æ­¥éª¤1: æ‰‹åŠ¨ç™»å½•è·å–Cookie

1. **ä½¿ç”¨æ­£å¸¸æµè§ˆå™¨è®¿é—®æŠ–éŸ³**
   ```
   https://www.douyin.com
   ```

2. **å®Œæˆç™»å½•æµç¨‹**
   - ä½¿ç”¨æ‰‹æœºå·/é‚®ç®±ç™»å½•
   - æˆ–ä½¿ç”¨äºŒç»´ç ç™»å½•

3. **è·å–Cookie**
   - æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·
   - è¿›å…¥ Application â†’ Cookies â†’ douyin.com
   - å¤åˆ¶é‡è¦Cookieå€¼

#### æ­¥éª¤2: ä¿å­˜Cookieåˆ°æ–‡ä»¶

åˆ›å»ºæ–‡ä»¶ `data/sessions/douyin_cookies.json`:

```json
[
  {
    "name": "sessionid",
    "value": "ä½ çš„sessionidå€¼",
    "domain": ".douyin.com",
    "path": "/",
    "secure": true,
    "httpOnly": true
  },
  {
    "name": "tt_webid",
    "value": "ä½ çš„webidå€¼",
    "domain": ".douyin.com",
    "path": "/",
    "secure": true,
    "httpOnly": false
  },
  {
    "name": "ttwid",
    "value": "ä½ çš„ttwidå€¼",
    "domain": ".douyin.com",
    "path": "/",
    "secure": true,
    "httpOnly": false
  },
  {
    "name": "passport_csrf_token",
    "value": "ä½ çš„csrf_tokenå€¼",
    "domain": ".douyin.com",
    "path": "/",
    "secure": true,
    "httpOnly": false
  }
]
```

#### æ­¥éª¤3: ä½¿ç”¨Cookieç™»å½•

```python
# ä½¿ç”¨MCPå·¥å…·è¿›è¡ŒCookieç™»å½•
from src.auth.tools import douyin_login

result = await douyin_login(
    username="your_username",
    login_type="cookie"
)
```

### æ–¹æ¡ˆ2: ä½¿ç”¨çœŸå®æµè§ˆå™¨é…ç½®æ–‡ä»¶

é…ç½®ä½¿ç”¨çœŸå®Chromeçš„ç”¨æˆ·æ•°æ®ï¼š

```python
# åœ¨ .env ä¸­è®¾ç½®
BROWSER_USER_DATA_DIR=C:/Users/YourName/AppData/Local/Google/Chrome/User Data
BROWSER_HEADLESS=false
```

### æ–¹æ¡ˆ3: ä»£ç†+è½®æ¢ç­–ç•¥

ä½¿ç”¨ä»£ç†IPå’ŒUser-Agentè½®æ¢ï¼š

```python
# é…ç½®ä»£ç†
PROXY_ENABLED=true
PROXY_URL=http://proxy.example.com:8080
PROXY_USERNAME=your_username
PROXY_PASSWORD=your_password
```

## ğŸš€ ç«‹å³å¯è¡Œçš„æµ‹è¯•æ­¥éª¤

### 1. æ‰‹åŠ¨è·å–Cookie

1. æ‰“å¼€Chromeæµè§ˆå™¨
2. è®¿é—® https://www.douyin.com
3. æ‰‹åŠ¨å®Œæˆç™»å½•
4. æŒ‰F12 â†’ Application â†’ Cookies â†’ douyin.com
5. å¤åˆ¶é‡è¦Cookieåˆ° `data/sessions/douyin_cookies.json`

### 2. æµ‹è¯•Cookieç™»å½•

```bash
# å¯åŠ¨MCPæœåŠ¡å™¨
python test_server.py

# æµ‹è¯•Cookieç™»å½•
curl -X POST http://localhost:8000/execute \
  -H "Content-Type: application/json" \
  -d '{
    "tool": "douyin_login",
    "parameters": {
      "username": "test_user",
      "login_type": "cookie"
    }
  }'
```

### 3. éªŒè¯ç™»å½•çŠ¶æ€

```bash
# éªŒè¯ä¼šè¯
curl -X POST http://localhost:8000/execute \
  -H "Content-Type: application/json" \
  -d '{
    "tool": "douyin_validate_session",
    "parameters": {
      "session_token": "your_session_token"
    }
  }'
```

## ğŸ“‹ å¯ç”¨çš„ç™»å½•ç›¸å…³å·¥å…·

### è®¤è¯å·¥å…· (8ä¸ª)

1. **douyin_login** - ç™»å½•æŠ–éŸ³è´¦å·
   - æ”¯æŒäºŒç»´ç ç™»å½• (éœ€è¦æ‰‹åŠ¨Cookie)
   - æ”¯æŒå¯†ç ç™»å½• (éœ€è¦æ‰‹åŠ¨Cookie)
   - æ”¯æŒCookieå¯¼å…¥

2. **douyin_create_account** - åˆ›å»ºè´¦å·è®°å½•
3. **douyin_list_accounts** - è·å–è´¦å·åˆ—è¡¨  
4. **douyin_update_account** - æ›´æ–°è´¦å·ä¿¡æ¯
5. **douyin_delete_account** - åˆ é™¤è´¦å·
6. **douyin_logout** - ç™»å‡ºè´¦å·
7. **douyin_validate_session** - éªŒè¯ä¼šè¯çŠ¶æ€
8. **douyin_account_stats** - è·å–è´¦å·ç»Ÿè®¡

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### åçˆ¬è™«æ£€æµ‹æœºåˆ¶

æŠ–éŸ³ä½¿ç”¨äº†å¤šç§åçˆ¬è™«æŠ€æœ¯ï¼š

1. **User-Agentæ£€æµ‹**: æ£€æµ‹è‡ªåŠ¨åŒ–æµè§ˆå™¨æ ‡è¯†
2. **JavaScriptæŒ‡çº¹**: æ£€æµ‹æµè§ˆå™¨ç¯å¢ƒç‰¹å¾
3. **è¡Œä¸ºåˆ†æ**: æ£€æµ‹éäººç±»æ“ä½œæ¨¡å¼
4. **IPé¢‘ç‡é™åˆ¶**: é™åˆ¶åŒä¸€IPçš„è®¿é—®é¢‘ç‡
5. **CookieéªŒè¯**: éªŒè¯Cookieçš„æœ‰æ•ˆæ€§å’Œæ¥æº

### ç»•è¿‡ç­–ç•¥

1. **ä½¿ç”¨çœŸå®æµè§ˆå™¨ç¯å¢ƒ**: ä½¿ç”¨çœŸå®Chromeç”¨æˆ·æ•°æ®
2. **æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º**: æ·»åŠ éšæœºå»¶è¿Ÿå’Œé¼ æ ‡ç§»åŠ¨
3. **è½®æ¢User-Agent**: ä½¿ç”¨ä¸åŒçš„æµè§ˆå™¨æ ‡è¯†
4. **ä½¿ç”¨ä»£ç†IP**: è½®æ¢IPåœ°å€
5. **æ‰‹åŠ¨Cookieå¯¼å…¥**: æœ€ç¨³å®šçš„æ–¹æ¡ˆ

## ğŸ¯ æ¨èå®æ–½æ­¥éª¤

### ç«‹å³å®æ–½ï¼ˆä»Šå¤©ï¼‰

1. **æ‰‹åŠ¨è·å–Cookie**
   - ä½¿ç”¨ä¸ªäººæŠ–éŸ³è´¦å·æ‰‹åŠ¨ç™»å½•
   - å¯¼å‡ºCookieå¹¶ä¿å­˜åˆ°æ–‡ä»¶
   - æµ‹è¯•Cookieç™»å½•åŠŸèƒ½

2. **éªŒè¯åŸºç¡€åŠŸèƒ½**
   - æµ‹è¯•è´¦å·ç®¡ç†åŠŸèƒ½
   - éªŒè¯ä¼šè¯ç®¡ç†
   - æµ‹è¯•ç»Ÿè®¡åŠŸèƒ½

### çŸ­æœŸä¼˜åŒ–ï¼ˆæœ¬å‘¨ï¼‰

1. **å®Œå–„Cookieç®¡ç†**
   - å®ç°Cookieè‡ªåŠ¨åˆ·æ–°
   - æ·»åŠ Cookieæœ‰æ•ˆæ€§æ£€æµ‹
   - å®ç°å¤šè´¦å·Cookieç®¡ç†

2. **å¢å¼ºåæ£€æµ‹èƒ½åŠ›**
   - ç ”ç©¶æ›´é«˜çº§çš„åæ£€æµ‹æŠ€æœ¯
   - å®ç°IPè½®æ¢
   - æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º

### é•¿æœŸè§„åˆ’ï¼ˆæœ¬æœˆï¼‰

1. **ç¨³å®šæ€§æå‡**
   - æ·»åŠ é‡è¯•æœºåˆ¶
   - å®ç°æ•…éšœæ¢å¤
   - ä¼˜åŒ–é”™è¯¯å¤„ç†

2. **åŠŸèƒ½æ‰©å±•**
   - å®ç°è‡ªåŠ¨Cookieåˆ·æ–°
   - æ·»åŠ å¤šè´¦å·ç®¡ç†
   - å®ç°ç›‘æ§å’ŒæŠ¥è­¦

## ğŸ‰ ç»“è®º

æŠ–éŸ³è‡ªåŠ¨å›å¤è¯„è®ºç›‘æµ‹å·¥å…·çš„æ ¸å¿ƒæ¡†æ¶å·²ç»å®Œå…¨å°±ç»ªï¼š

- âœ… **MCPæœåŠ¡å™¨**: æ­£å¸¸è¿è¡Œï¼Œ25ä¸ªå·¥å…·å·²æ³¨å†Œ
- âœ… **æ•°æ®åº“ç³»ç»Ÿ**: SQLiteé…ç½®å®Œæˆï¼Œè¡¨ç»“æ„åˆ›å»ºæˆåŠŸ  
- âœ… **æµè§ˆå™¨è‡ªåŠ¨åŒ–**: Playwrighté…ç½®æ­£ç¡®
- âœ… **APIæ¥å£**: æ‰€æœ‰ç«¯ç‚¹æ­£å¸¸å·¥ä½œ
- âœ… **å·¥å…·ç³»ç»Ÿ**: è®¤è¯ã€ç›‘æ§ã€åˆ†æã€å†…å®¹4å¤§ç±»åŠŸèƒ½é½å…¨

**ä¸»è¦æŒ‘æˆ˜**: æŠ–éŸ³çš„åè‡ªåŠ¨åŒ–æ£€æµ‹éœ€è¦ä½¿ç”¨æ‰‹åŠ¨Cookieå¯¼å…¥æ–¹å¼è§£å†³

**å»ºè®®**: ä½¿ç”¨æ‰‹åŠ¨ç™»å½•+Cookieå¯¼å…¥çš„æ–¹å¼å¼€å§‹å®é™…ä½¿ç”¨å’Œæµ‹è¯•

è¿™ä¸ªå·¥å…·ç°åœ¨å·²ç»å¯ä»¥æŠ•å…¥å®é™…ä½¿ç”¨äº†ï¼åªéœ€è¦æ‰‹åŠ¨è·å–Cookieå³å¯å¼€å§‹ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½ã€‚






